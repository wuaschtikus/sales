{% extends '../base/base.html' %}
{% block content %}
{% include '../base/snippets/navbar.html' %}

<section class="pb-2">
    <div class="pl-5">
        <h1 class="title">Add Email</h1>
    </div>
</section>

<section>
    <div class="box ml-6 mr-6">
        <h1>Upload a File</h1>
        <form id="upload-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="field">
                <label class="label">Convert single .msg file to .eml</label>
                <p>Convert MSG files, which are commonly used by Microsoft Outlook to store individual email messages, into EML files, a more universal format that is widely supported by various email clients for storing email data in a text-based format.</p>
            </div>
            <div class="file has-name is-fullwidth">
                <label class="file-label">
                    <input class="file-input" type="file" name="file" id="file-input"/>
                    <span class="file-cta">
                        <span class="file-icon">
                            <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label"> Choose a fileâ€¦ </span>
                    </span>
                    <span class="file-name" id="file-name">
                        {% if file_name %}
                            {{ file_name }}
                        {% else %}
                            No file selected
                        {% endif %}
                    </span>
                </label>
            </div>
            <button type="submit" class="button is-primary">Convert</button>
        </form>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const fileInput = document.querySelector('#file-input');
                const fileName = document.querySelector('#file-name');
                const form = document.querySelector('#upload-form');

                fileInput.addEventListener('change', () => {
                    if (fileInput.files.length > 0) {
                        fileName.textContent = fileInput.files[0].name;
                        //form.submit();  // Automatically submit the form when a file is selected
                    }
                });
            });
        </script>
        </div>
    </div>
</section>

{% if eml_download_url %}
<section class="pb-2 pt-2">
    <div class="pl-5">
        <h3 class="title">Result</h3>
    </div>
</section>

<section>
    <div class="box ml-6 mr-6">
        <label class="label">File Size: {{ file_size }}</label>
        <a href="{{ eml_download_url }}" class="button">Download {{ file_name_download }}</a>
    </div>
</section>
{% endif %}
    

{% endblock %}

